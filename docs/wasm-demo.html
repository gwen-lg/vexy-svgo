<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vexy SVGO WASM Demo - Pure WebAssembly SVG Optimizer</title>

    <!-- DaisyUI + Tailwind CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@4.6.0/dist/full.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Prism.js for code highlighting -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-xml-doc.min.js"></script>

    <style>
      .svg-preview {
        background-image: linear-gradient(45deg, #f0f0f0 25%, transparent 25%),
          linear-gradient(-45deg, #f0f0f0 25%, transparent 25%),
          linear-gradient(45deg, transparent 75%, #f0f0f0 75%),
          linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
        background-size: 20px 20px;
        background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
      }

      pre[class*='language-'] {
        max-height: 400px;
        font-size: 0.875rem;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
      }
    </style>
  </head>
  <body class="min-h-screen bg-base-200">
    <!-- Header -->
    <div class="navbar bg-base-100 shadow-lg">
      <div class="navbar-start">
        <a class="btn btn-ghost text-xl">Vexy SVGO WASM</a>
      </div>
      <div class="navbar-center hidden lg:flex">
        <ul class="menu menu-horizontal px-1">
          <li><a href="#features">Features</a></li>
          <li><a href="#demo">Demo</a></li>
          <li>
            <a href="https://github.com/twardoch/vexy_svgo" target="_blank"
              >GitHub</a
            >
          </li>
        </ul>
      </div>
      <div class="navbar-end">
        <label class="swap swap-rotate">
          <input type="checkbox" id="themeToggle" />
          <svg
            class="swap-on fill-current w-6 h-6"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
          >
            <path
              d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"
            />
          </svg>
          <svg
            class="swap-off fill-current w-6 h-6"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
          >
            <path
              d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"
            />
          </svg>
        </label>
      </div>
    </div>

    <!-- Hero Section -->
    <div class="hero min-h-[300px] bg-base-100">
      <div class="hero-content text-center">
        <div class="max-w-md">
          <h1 class="text-5xl font-bold">Vexy SVGO WebAssembly</h1>
          <p class="py-6">
            High-performance SVG optimization running directly in your browser.
            No server required.
          </p>
          <div id="loadingStatus" class="alert alert-info">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              class="stroke-current shrink-0 w-6 h-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              ></path>
            </svg>
            <span>Loading WebAssembly module...</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Features Section -->
    <section id="features" class="py-8 px-4">
      <div class="container mx-auto">
        <h2 class="text-3xl font-bold text-center mb-8">Features</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
              <h3 class="card-title">ðŸš€ Fast</h3>
              <p>
                Native Rust performance compiled to WebAssembly for near-native
                speed in the browser.
              </p>
            </div>
          </div>
          <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
              <h3 class="card-title">ðŸ”’ Private</h3>
              <p>
                All processing happens locally in your browser. Your SVG files
                never leave your device.
              </p>
            </div>
          </div>
          <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
              <h3 class="card-title">âš¡ Efficient</h3>
              <p>
                Optimized WASM bundle with minimal overhead. Supports streaming
                for large files.
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Demo Section -->
    <section id="demo" class="py-8 px-4" style="display: none">
      <div class="container mx-auto">
        <h2 class="text-3xl font-bold text-center mb-8">Try It Now</h2>

        <!-- Options -->
        <div class="card bg-base-100 shadow-xl mb-6">
          <div class="card-body">
            <h3 class="card-title mb-4">Optimization Options</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              <div class="form-control">
                <label class="label cursor-pointer">
                  <span class="label-text">Multipass</span>
                  <input
                    type="checkbox"
                    id="optMultipass"
                    class="checkbox checkbox-primary"
                  />
                </label>
              </div>
              <div class="form-control">
                <label class="label cursor-pointer">
                  <span class="label-text">Pretty Print</span>
                  <input
                    type="checkbox"
                    id="optPretty"
                    class="checkbox checkbox-primary"
                  />
                </label>
              </div>
              <div class="form-control">
                <label class="label">
                  <span class="label-text">Indent Size</span>
                </label>
                <input
                  type="number"
                  id="optIndent"
                  value="2"
                  min="0"
                  max="8"
                  class="input input-bordered input-sm w-20"
                />
              </div>
              <div class="form-control">
                <label class="label">
                  <span class="label-text">Precision</span>
                </label>
                <input
                  type="number"
                  id="optPrecision"
                  value="3"
                  min="0"
                  max="10"
                  class="input input-bordered input-sm w-20"
                />
              </div>
            </div>

            <div class="divider">Plugins</div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
              <label class="label cursor-pointer">
                <span class="label-text text-sm">Remove Comments</span>
                <input
                  type="checkbox"
                  id="pluginRemoveComments"
                  class="checkbox checkbox-sm"
                  checked
                />
              </label>
              <label class="label cursor-pointer">
                <span class="label-text text-sm">Remove Empty Attrs</span>
                <input
                  type="checkbox"
                  id="pluginRemoveEmptyAttrs"
                  class="checkbox checkbox-sm"
                  checked
                />
              </label>
              <label class="label cursor-pointer">
                <span class="label-text text-sm">Collapse Groups</span>
                <input
                  type="checkbox"
                  id="pluginCollapseGroups"
                  class="checkbox checkbox-sm"
                  checked
                />
              </label>
              <label class="label cursor-pointer">
                <span class="label-text text-sm">Convert Colors</span>
                <input
                  type="checkbox"
                  id="pluginConvertColors"
                  class="checkbox checkbox-sm"
                  checked
                />
              </label>
              <label class="label cursor-pointer">
                <span class="label-text text-sm">Cleanup IDs</span>
                <input
                  type="checkbox"
                  id="pluginCleanupIds"
                  class="checkbox checkbox-sm"
                  checked
                />
              </label>
              <label class="label cursor-pointer">
                <span class="label-text text-sm">Remove Useless Defs</span>
                <input
                  type="checkbox"
                  id="pluginRemoveUselessDefs"
                  class="checkbox checkbox-sm"
                  checked
                />
              </label>
              <label class="label cursor-pointer">
                <span class="label-text text-sm">Merge Paths</span>
                <input
                  type="checkbox"
                  id="pluginMergePaths"
                  class="checkbox checkbox-sm"
                  checked
                />
              </label>
              <label class="label cursor-pointer">
                <span class="label-text text-sm">Convert Shapes</span>
                <input
                  type="checkbox"
                  id="pluginConvertShapes"
                  class="checkbox checkbox-sm"
                  checked
                />
              </label>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="flex flex-wrap gap-4 mb-6 justify-center">
          <button id="btnOptimize" class="btn btn-primary">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="w-6 h-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
              />
            </svg>
            Optimize SVG
          </button>
          <button id="btnLoadExample" class="btn btn-secondary">
            Load Example
          </button>
          <button id="btnClear" class="btn btn-ghost">Clear All</button>
          <label for="fileInput" class="btn btn-outline">
            <input
              type="file"
              id="fileInput"
              accept=".svg,image/svg+xml"
              class="hidden"
            />
            Upload SVG
          </label>
          <button
            id="btnDownload"
            class="btn btn-success"
            style="display: none"
          >
            Download Result
          </button>
        </div>

        <!-- Input/Output -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Input -->
          <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
              <h3 class="card-title">Input SVG</h3>
              <div class="form-control">
                <textarea
                  id="inputSvg"
                  class="textarea textarea-bordered h-64 font-mono text-sm"
                  placeholder="Paste your SVG here or click 'Load Example'"
                ></textarea>
              </div>
              <div
                class="svg-preview min-h-[200px] rounded-lg p-4 mt-4"
                id="inputPreview"
              ></div>
            </div>
          </div>

          <!-- Output -->
          <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
              <h3 class="card-title">Optimized SVG</h3>
              <div class="form-control">
                <textarea
                  id="outputSvg"
                  class="textarea textarea-bordered h-64 font-mono text-sm"
                  placeholder="Optimized SVG will appear here"
                  readonly
                ></textarea>
              </div>
              <div
                class="svg-preview min-h-[200px] rounded-lg p-4 mt-4"
                id="outputPreview"
              ></div>
            </div>
          </div>
        </div>

        <!-- Statistics -->
        <div
          id="stats"
          class="card bg-base-100 shadow-xl mt-6"
          style="display: none"
        >
          <div class="card-body">
            <h3 class="card-title mb-4">Optimization Statistics</h3>
            <div class="stats-grid">
              <div class="stat">
                <div class="stat-title">Original Size</div>
                <div class="stat-value text-primary" id="statOriginal">-</div>
              </div>
              <div class="stat">
                <div class="stat-title">Optimized Size</div>
                <div class="stat-value text-secondary" id="statOptimized">
                  -
                </div>
              </div>
              <div class="stat">
                <div class="stat-title">Reduction</div>
                <div class="stat-value text-accent" id="statReduction">-</div>
              </div>
              <div class="stat">
                <div class="stat-title">Time</div>
                <div class="stat-value" id="statTime">-</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer
      class="footer footer-center p-10 bg-base-100 text-base-content mt-auto"
    >
      <div>
        <p>Copyright Â© 2024 - Vexy SVGO Project</p>
        <p>High-performance SVG optimization powered by Rust and WebAssembly</p>
      </div>
    </footer>

    <script type="module">
      let vexy_svgo = null;
      let wasmModule = null;

      // Theme handling
      const themeToggle = document.getElementById('themeToggle');
      const html = document.documentElement;

      themeToggle.addEventListener('change', (e) => {
        html.setAttribute('data-theme', e.target.checked ? 'dark' : 'light');
        localStorage.setItem('theme', e.target.checked ? 'dark' : 'light');
      });

      // Load saved theme
      const savedTheme = localStorage.getItem('theme') || 'light';
      html.setAttribute('data-theme', savedTheme);
      themeToggle.checked = savedTheme === 'dark';

      // Initialize WASM
      async function initWasm() {
        try {
          const wasmResponse = await fetch('./vexy_svgo_wasm_bg.wasm');
          const wasmBytes = await wasmResponse.arrayBuffer();

          // Basic WASM instantiation
          const importObject = {
            wbindgen: {
              __wbindgen_throw: (ptr, len) => {
                const msg = getStringFromWasm(ptr, len);
                throw new Error(msg);
              },
              __wbindgen_rethrow: (idx) => {
                throw takeObject(idx);
              },
            },
          };

          const { instance } = await WebAssembly.instantiate(
            wasmBytes,
            importObject
          );
          wasmModule = instance.exports;

          // Initialize the module
          if (wasmModule.__wbindgen_start) {
            wasmModule.__wbindgen_start();
          }

          // Create wrapper API
          vexy_svgo = {
            optimize: (svg, config = {}) => {
              const svgPtr = allocString(svg);
              const configPtr = allocString(JSON.stringify(config));

              try {
                const resultPtr = wasmModule.optimize(
                  svgPtr,
                  svg.length,
                  configPtr,
                  JSON.stringify(config).length
                );
                const result = getStringFromWasm(
                  resultPtr,
                  wasmModule.__wbindgen_export_0
                );
                wasmModule.__wbindgen_free(
                  resultPtr,
                  wasmModule.__wbindgen_export_0
                );
                return JSON.parse(result);
              } finally {
                wasmModule.__wbindgen_free(svgPtr, svg.length);
                wasmModule.__wbindgen_free(
                  configPtr,
                  JSON.stringify(config).length
                );
              }
            },

            version: () => {
              const ptr = wasmModule.get_version();
              const version = getStringFromWasm(
                ptr,
                wasmModule.__wbindgen_export_0
              );
              wasmModule.__wbindgen_free(ptr, wasmModule.__wbindgen_export_0);
              return version;
            },
          };

          // Show success
          document.getElementById('loadingStatus').innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <span>Vexy SVGO WebAssembly loaded successfully! Version: ${vexy_svgo.version()}</span>
                `;
          document.getElementById('loadingStatus').className =
            'alert alert-success';
          document.getElementById('demo').style.display = 'block';
        } catch (error) {
          console.error('Failed to load WASM:', error);
          document.getElementById('loadingStatus').innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <span>Failed to load WebAssembly: ${error.message}</span>
                `;
          document.getElementById('loadingStatus').className =
            'alert alert-error';
        }
      }

      // Helper functions for WASM memory management
      function allocString(str) {
        const encoder = new TextEncoder();
        const encoded = encoder.encode(str);
        const ptr = wasmModule.__wbindgen_malloc(encoded.length);
        new Uint8Array(wasmModule.memory.buffer, ptr, encoded.length).set(
          encoded
        );
        return ptr;
      }

      function getStringFromWasm(ptr, len) {
        const buffer = new Uint8Array(wasmModule.memory.buffer, ptr, len);
        return new TextDecoder().decode(buffer);
      }

      const heap = new Array(32).fill(undefined);
      heap.push(undefined, null, true, false);
      let heap_next = heap.length;

      function takeObject(idx) {
        const ret = heap[idx];
        heap[idx] = heap_next;
        heap_next = idx;
        return ret;
      }

      // Optimize function
      function optimizeSvg() {
        const input = document.getElementById('inputSvg').value.trim();
        if (!input) {
          showToast('Please enter an SVG to optimize', 'warning');
          return;
        }

        try {
          // Build configuration
          const config = {
            multipass: document.getElementById('optMultipass').checked,
            pretty: document.getElementById('optPretty').checked,
            indent: parseInt(document.getElementById('optIndent').value) || 2,
            precision:
              parseInt(document.getElementById('optPrecision').value) || 3,
            plugins: {},
          };

          // Add plugins
          const plugins = [
            'removeComments',
            'removeEmptyAttrs',
            'collapseGroups',
            'convertColors',
            'cleanupIds',
            'removeUselessDefs',
            'mergePaths',
            'convertShapes',
          ];

          plugins.forEach((plugin) => {
            const checkbox = document.getElementById(
              'plugin' + plugin.charAt(0).toUpperCase() + plugin.slice(1)
            );
            if (checkbox) {
              config.plugins[plugin] = checkbox.checked;
            }
          });

          // Measure time
          const startTime = performance.now();
          const result = vexy_svgo.optimize(input, config);
          const duration = performance.now() - startTime;

          // Display results
          document.getElementById('outputSvg').value = result.data;
          updatePreview('outputPreview', result.data);

          // Update stats
          document.getElementById('statOriginal').textContent = formatBytes(
            result.originalSize
          );
          document.getElementById('statOptimized').textContent = formatBytes(
            result.optimizedSize
          );
          document.getElementById('statReduction').textContent =
            result.sizeReduction.toFixed(1) + '%';
          document.getElementById('statTime').textContent =
            duration.toFixed(1) + 'ms';
          document.getElementById('stats').style.display = 'block';
          document.getElementById('btnDownload').style.display = 'inline-flex';

          showToast('Optimization completed successfully!', 'success');
        } catch (error) {
          showToast(`Optimization failed: ${error.message}`, 'error');
          console.error('Optimization error:', error);
        }
      }

      // Helper functions
      function updatePreview(id, svg) {
        const preview = document.getElementById(id);
        try {
          preview.innerHTML = svg;
          // Ensure SVGs fit in preview
          const svgElement = preview.querySelector('svg');
          if (svgElement) {
            svgElement.style.maxWidth = '100%';
            svgElement.style.height = 'auto';
          }
        } catch (e) {
          preview.innerHTML = '<div class="text-error">Invalid SVG</div>';
        }
      }

      function formatBytes(bytes) {
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
        return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
      }

      function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `toast toast-top toast-end`;
        toast.innerHTML = `
                <div class="alert alert-${type}">
                    <span>${message}</span>
                </div>
            `;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
      }

      function loadExample() {
        const exampleSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200">
  <!-- Background circle -->
  <defs>
    <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(79,70,229);stop-opacity:1" />
      <stop offset="100%" style="stop-color:rgb(147,51,234);stop-opacity:1" />
    </linearGradient>
  </defs>
  
  <g id="logo-group">
    <circle cx="100" cy="100" r="90" fill="url(#gradient1)" stroke="#ffffff" stroke-width="4"/>
    
    <!-- Vexy SVGO Text -->
    <text x="100" y="90" text-anchor="middle" font-family="Arial, sans-serif" font-size="48" font-weight="bold" fill="white">
      Vexy SVGO
    </text>
    
    <!-- Tagline -->
    <text x="100" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" fill="white" opacity="0.9">
      Optimize SVGs
    </text>
    
    <!-- Decorative elements -->
    <rect x="40" y="140" width="30" height="3" rx="1.5" fill="white" opacity="0.7"/>
    <rect x="85" y="140" width="30" height="3" rx="1.5" fill="white" opacity="0.7"/>
    <rect x="130" y="140" width="30" height="3" rx="1.5" fill="white" opacity="0.7"/>
  </g>
</svg>`;
        document.getElementById('inputSvg').value = exampleSvg;
        updatePreview('inputPreview', exampleSvg);
      }

      function clearAll() {
        document.getElementById('inputSvg').value = '';
        document.getElementById('outputSvg').value = '';
        document.getElementById('inputPreview').innerHTML = '';
        document.getElementById('outputPreview').innerHTML = '';
        document.getElementById('stats').style.display = 'none';
        document.getElementById('btnDownload').style.display = 'none';
      }

      function downloadResult() {
        const output = document.getElementById('outputSvg').value;
        if (!output) return;

        const blob = new Blob([output], { type: 'image/svg+xml' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'optimized.svg';
        a.click();
        URL.revokeObjectURL(url);
      }

      function handleFileUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          document.getElementById('inputSvg').value = e.target.result;
          updatePreview('inputPreview', e.target.result);
        };
        reader.readAsText(file);
      }

      // Event listeners
      document
        .getElementById('btnOptimize')
        .addEventListener('click', optimizeSvg);
      document
        .getElementById('btnLoadExample')
        .addEventListener('click', loadExample);
      document.getElementById('btnClear').addEventListener('click', clearAll);
      document
        .getElementById('btnDownload')
        .addEventListener('click', downloadResult);
      document
        .getElementById('fileInput')
        .addEventListener('change', handleFileUpload);

      // Update preview on input change
      document.getElementById('inputSvg').addEventListener('input', (e) => {
        updatePreview('inputPreview', e.target.value);
      });

      // Initialize
      initWasm();
    </script>
  </body>
</html>
