
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://vexyart.github.io/vexy-svgo/developer/plugin-development/">
      
      
        <link rel="prev" href="../benchmarks/">
      
      
        <link rel="next" href="../plugin-migration/">
      
      
      <link rel="icon" href="../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>Plugin Development Tutorial - Vexy SVGO</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/css/main.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#plugin-development-tutorial" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Vexy SVGO" class="md-header__button md-logo" aria-label="Vexy SVGO" data-md-component="logo">
      
  <img src="../../assets/favicon.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Vexy SVGO
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Plugin Development Tutorial
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/vexyart/vexy-svgo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    vexyart/vexy-svgo
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Vexy SVGO" class="md-nav__button md-logo" aria-label="Vexy SVGO" data-md-component="logo">
      
  <img src="../../assets/favicon.ico" alt="logo">

    </a>
    Vexy SVGO
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/vexyart/vexy-svgo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    vexyart/vexy-svgo
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vexy SVGO
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Developer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Developer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Developer Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../benchmarks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Performance Benchmarks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Plugin Development Tutorial
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Plugin Development Tutorial
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-create-plugins" class="md-nav__link">
    <span class="md-ellipsis">
      Why Create Plugins?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plugin-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Plugin Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Plugin Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Core Concepts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plugin-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      Plugin Lifecycle
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-your-development-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Setting Up Your Development Environment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setting Up Your Development Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Project Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-your-first-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      Creating Your First Plugin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creating Your First Plugin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-create-the-plugin-module" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Create the Plugin Module
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-register-the-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Register the Plugin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-build-and-test" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Build and Test
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-plugin-development" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Plugin Development
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Plugin Development">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#working-with-complex-ast-transformations" class="md-nav__link">
    <span class="md-ellipsis">
      Working with Complex AST Transformations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plugin-state-and-context" class="md-nav__link">
    <span class="md-ellipsis">
      Plugin State and Context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-your-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Your Plugin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Your Plugin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unit-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Unit Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#svgo-compatibility-testing" class="md-nav__link">
    <span class="md-ellipsis">
      SVGO Compatibility Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Integration Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Testing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#publishing-and-distribution" class="md-nav__link">
    <span class="md-ellipsis">
      Publishing and Distribution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Publishing and Distribution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-package-your-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      1. Package Your Plugin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      2. Documentation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-publish-to-cratesio" class="md-nav__link">
    <span class="md-ellipsis">
      3. Publish to crates.io
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-performance-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      1. Performance Optimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      2. Error Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-configuration-validation" class="md-nav__link">
    <span class="md-ellipsis">
      3. Configuration Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-compatibility" class="md-nav__link">
    <span class="md-ellipsis">
      4. Compatibility
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plugin-ideas" class="md-nav__link">
    <span class="md-ellipsis">
      Plugin Ideas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin-migration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plugin Migration Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin-reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plugin Implementation Reference
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    User
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            User
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/cli-usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLI Usage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/demo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interactive Demo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/plugins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plugin Reference
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-create-plugins" class="md-nav__link">
    <span class="md-ellipsis">
      Why Create Plugins?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plugin-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Plugin Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Plugin Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Core Concepts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plugin-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      Plugin Lifecycle
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-your-development-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Setting Up Your Development Environment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setting Up Your Development Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Project Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-your-first-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      Creating Your First Plugin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creating Your First Plugin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-create-the-plugin-module" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Create the Plugin Module
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-register-the-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Register the Plugin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-build-and-test" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Build and Test
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-plugin-development" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Plugin Development
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Plugin Development">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#working-with-complex-ast-transformations" class="md-nav__link">
    <span class="md-ellipsis">
      Working with Complex AST Transformations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plugin-state-and-context" class="md-nav__link">
    <span class="md-ellipsis">
      Plugin State and Context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-your-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Your Plugin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Your Plugin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unit-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Unit Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#svgo-compatibility-testing" class="md-nav__link">
    <span class="md-ellipsis">
      SVGO Compatibility Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Integration Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Testing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#publishing-and-distribution" class="md-nav__link">
    <span class="md-ellipsis">
      Publishing and Distribution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Publishing and Distribution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-package-your-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      1. Package Your Plugin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      2. Documentation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-publish-to-cratesio" class="md-nav__link">
    <span class="md-ellipsis">
      3. Publish to crates.io
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-performance-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      1. Performance Optimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      2. Error Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-configuration-validation" class="md-nav__link">
    <span class="md-ellipsis">
      3. Configuration Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-compatibility" class="md-nav__link">
    <span class="md-ellipsis">
      4. Compatibility
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plugin-ideas" class="md-nav__link">
    <span class="md-ellipsis">
      Plugin Ideas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="plugin-development-tutorial">Plugin Development Tutorial<a class="headerlink" href="#plugin-development-tutorial" title="Permanent link">&para;</a></h1>
<p>This comprehensive guide will walk you through creating custom plugins for Vexy SVGO, from basic concepts to advanced techniques.</p>
<h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#plugin-architecture">Plugin Architecture</a></li>
<li><a href="#setting-up-your-development-environment">Setting Up Your Development Environment</a></li>
<li><a href="#creating-your-first-plugin">Creating Your First Plugin</a></li>
<li><a href="#advanced-plugin-development">Advanced Plugin Development</a></li>
<li><a href="#testing-your-plugin">Testing Your Plugin</a></li>
<li><a href="#publishing-and-distribution">Publishing and Distribution</a></li>
<li><a href="#best-practices">Best Practices</a></li>
</ol>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Vexy SVGO plugins are Rust modules that implement the <code>Plugin</code> trait from the <code>vexy-svgo-plugin-sdk</code>. They can traverse and modify the SVG AST (Abstract Syntax Tree) to perform optimizations.</p>
<h3 id="why-create-plugins">Why Create Plugins?<a class="headerlink" href="#why-create-plugins" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Custom Optimizations</strong>: Implement domain-specific optimizations</li>
<li><strong>Extended Functionality</strong>: Add features beyond standard SVGO compatibility</li>
<li><strong>Performance</strong>: Native Rust performance for complex transformations</li>
<li><strong>Integration</strong>: Seamlessly integrate with existing Vexy SVGO workflows</li>
</ul>
<h2 id="plugin-architecture">Plugin Architecture<a class="headerlink" href="#plugin-architecture" title="Permanent link">&para;</a></h2>
<h3 id="core-concepts">Core Concepts<a class="headerlink" href="#core-concepts" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>AST (Abstract Syntax Tree)</strong>: The parsed representation of an SVG document</li>
<li><strong>Visitor Pattern</strong>: Plugins traverse the AST using the visitor pattern</li>
<li><strong>Plugin Trait</strong>: The interface all plugins must implement</li>
<li><strong>Configuration</strong>: Plugins can accept parameters for customization</li>
</ol>
<h3 id="plugin-lifecycle">Plugin Lifecycle<a class="headerlink" href="#plugin-lifecycle" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>SVG Input → Parser → AST → Plugin Pipeline → Modified AST → Stringifier → Optimized SVG
</code></pre></div>
<h2 id="setting-up-your-development-environment">Setting Up Your Development Environment<a class="headerlink" href="#setting-up-your-development-environment" title="Permanent link">&para;</a></h2>
<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Install Rust</span>
curl<span class="w"> </span>--proto<span class="w"> </span><span class="s1">&#39;=https&#39;</span><span class="w"> </span>--tlsv1.2<span class="w"> </span>-sSf<span class="w"> </span>https://sh.rustup.rs<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh

<span class="c1"># Clone the Vexy SVGO repository</span>
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/vexyart/vexy-svgo
<span class="nb">cd</span><span class="w"> </span>vexy-svgo

<span class="c1"># Build the project</span>
./build.sh
</code></pre></div>
<h3 id="project-structure">Project Structure<a class="headerlink" href="#project-structure" title="Permanent link">&para;</a></h3>
<p>Create a new directory for your plugin:</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>crates/plugin-sdk/src/plugins/my_custom_plugin
<span class="nb">cd</span><span class="w"> </span>crates/plugin-sdk/src/plugins/my_custom_plugin
</code></pre></div>
<h2 id="creating-your-first-plugin">Creating Your First Plugin<a class="headerlink" href="#creating-your-first-plugin" title="Permanent link">&para;</a></h2>
<p>Let's create a simple plugin that adds a custom attribute to all <code>&lt;rect&gt;</code> elements.</p>
<h3 id="step-1-create-the-plugin-module">Step 1: Create the Plugin Module<a class="headerlink" href="#step-1-create-the-plugin-module" title="Permanent link">&para;</a></h3>
<p>Create <code>crates/plugin-sdk/src/plugins/my_custom_plugin.rs</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// this_file: crates/plugin-sdk/src/plugins/my_custom_plugin.rs</span>

<span class="k">use</span><span class="w"> </span><span class="k">crate</span><span class="p">::</span><span class="n">Plugin</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">anyhow</span><span class="p">::</span><span class="nb">Result</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">serde</span><span class="p">::{</span><span class="n">Deserialize</span><span class="p">,</span><span class="w"> </span><span class="n">Serialize</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">serde_json</span><span class="p">::</span><span class="n">Value</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">vexy_svgo_core</span><span class="p">::</span><span class="n">ast</span><span class="p">::{</span><span class="n">Document</span><span class="p">,</span><span class="w"> </span><span class="n">Element</span><span class="p">,</span><span class="w"> </span><span class="n">Node</span><span class="p">};</span>

<span class="sd">/// Configuration for the custom plugin</span>
<span class="cp">#[derive(Debug, Clone, Serialize, Deserialize)]</span>
<span class="cp">#[serde(rename_all = </span><span class="s">&quot;camelCase&quot;</span><span class="cp">, deny_unknown_fields)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">MyCustomPluginConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="sd">/// Attribute name to add</span>
<span class="w">    </span><span class="cp">#[serde(default = </span><span class="s">&quot;default_attr_name&quot;</span><span class="cp">)]</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">attr_name</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="sd">/// Attribute value to add</span>
<span class="w">    </span><span class="cp">#[serde(default = </span><span class="s">&quot;default_attr_value&quot;</span><span class="cp">)]</span><span class="w">  </span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">attr_value</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="sd">/// Only process elements with these tag names</span>
<span class="w">    </span><span class="cp">#[serde(default)]</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">target_elements</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">fn</span><span class="w"> </span><span class="nf">default_attr_name</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;data-processed&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">fn</span><span class="w"> </span><span class="nf">default_attr_value</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;true&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="nb">Default</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyCustomPluginConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">default</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">attr_name</span><span class="p">:</span><span class="w"> </span><span class="nc">default_attr_name</span><span class="p">(),</span>
<span class="w">            </span><span class="n">attr_value</span><span class="p">:</span><span class="w"> </span><span class="nc">default_attr_value</span><span class="p">(),</span>
<span class="w">            </span><span class="n">target_elements</span><span class="p">:</span><span class="w"> </span><span class="nc">vec</span><span class="o">!</span><span class="p">[</span><span class="s">&quot;rect&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()],</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="sd">/// Plugin that adds custom attributes to specified elements</span>
<span class="cp">#[derive(Clone)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">MyCustomPlugin</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">config</span><span class="p">:</span><span class="w"> </span><span class="nc">MyCustomPluginConfig</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">MyCustomPlugin</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">new</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">config</span><span class="p">:</span><span class="w"> </span><span class="nc">MyCustomPluginConfig</span><span class="p">::</span><span class="n">default</span><span class="p">(),</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">with_config</span><span class="p">(</span><span class="n">config</span><span class="p">:</span><span class="w"> </span><span class="nc">MyCustomPluginConfig</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">Self</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">parse_config</span><span class="p">(</span><span class="n">params</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">Value</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">MyCustomPluginConfig</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">params</span><span class="p">.</span><span class="n">is_null</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nb">Ok</span><span class="p">(</span><span class="n">MyCustomPluginConfig</span><span class="p">::</span><span class="n">default</span><span class="p">())</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">serde_json</span><span class="p">::</span><span class="n">from_value</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">clone</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="n">map_err</span><span class="p">(</span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"> </span><span class="n">anyhow</span><span class="p">::</span><span class="n">anyhow</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;Invalid plugin configuration: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">))</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">process_element</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">element</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Element</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Check if this element should be processed</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">target_elements</span><span class="p">.</span><span class="n">is_empty</span><span class="p">()</span><span class="w"> </span>
<span class="w">           </span><span class="o">||</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">target_elements</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="o">&amp;</span><span class="n">element</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="n">to_string</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Add the custom attribute</span>
<span class="w">            </span><span class="n">element</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span>
<span class="w">                </span><span class="bp">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">attr_name</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span>
<span class="w">                </span><span class="bp">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">attr_value</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Recursively process child elements</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">element</span><span class="p">.</span><span class="n">children</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="bp">self</span><span class="p">.</span><span class="n">process_element</span><span class="p">(</span><span class="n">elem</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="nb">Default</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyCustomPlugin</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">default</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">Self</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyCustomPlugin</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="nb">static</span><span class="w"> </span><span class="kt">str</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;myCustomPlugin&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="nb">static</span><span class="w"> </span><span class="kt">str</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;adds custom attributes to specified elements&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">validate_params</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">Value</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">Self</span><span class="p">::</span><span class="n">parse_config</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">document</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Document</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">process_element</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">document</span><span class="p">.</span><span class="n">root</span><span class="p">);</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="cp">#[cfg(test)]</span>
<span class="k">mod</span><span class="w"> </span><span class="nn">tests</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">serde_json</span><span class="p">::</span><span class="n">json</span><span class="p">;</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">borrow</span><span class="p">::</span><span class="n">Cow</span><span class="p">;</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">create_element</span><span class="p">(</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="nb">static</span><span class="w"> </span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Element</span><span class="o">&lt;&#39;</span><span class="nb">static</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Element</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="w">        </span><span class="n">element</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cow</span><span class="p">::</span><span class="n">Borrowed</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="w">        </span><span class="n">element</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cp">#[test]</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">test_plugin_info</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">plugin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyCustomPlugin</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">        </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">plugin</span><span class="p">.</span><span class="n">name</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;myCustomPlugin&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">plugin</span><span class="p">.</span><span class="n">description</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;adds custom attributes to specified elements&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cp">#[test]</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">test_adds_attribute_to_target_elements</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">plugin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyCustomPlugin</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Document</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">svg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_element</span><span class="p">(</span><span class="s">&quot;svg&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">svg</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">create_element</span><span class="p">(</span><span class="s">&quot;rect&quot;</span><span class="p">)));</span>
<span class="w">        </span><span class="n">svg</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">create_element</span><span class="p">(</span><span class="s">&quot;circle&quot;</span><span class="p">)));</span>
<span class="w">        </span><span class="n">doc</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">svg</span><span class="p">;</span>

<span class="w">        </span><span class="n">plugin</span><span class="p">.</span><span class="n">apply</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">doc</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Check that rect got the attribute</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">doc</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;data-processed&quot;</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="s">&quot;true&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Check that circle did not get the attribute (not in target_elements)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">doc</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">assert!</span><span class="p">(</span><span class="o">!</span><span class="n">circle</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">contains_key</span><span class="p">(</span><span class="s">&quot;data-processed&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cp">#[test]</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">test_custom_configuration</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyCustomPluginConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">attr_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;data-custom&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span>
<span class="w">            </span><span class="n">attr_value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;processed&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span>
<span class="w">            </span><span class="n">target_elements</span><span class="p">:</span><span class="w"> </span><span class="nc">vec</span><span class="o">!</span><span class="p">[</span><span class="s">&quot;circle&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()],</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">plugin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyCustomPlugin</span><span class="p">::</span><span class="n">with_config</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Document</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">svg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_element</span><span class="p">(</span><span class="s">&quot;svg&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">svg</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">create_element</span><span class="p">(</span><span class="s">&quot;circle&quot;</span><span class="p">)));</span>
<span class="w">        </span><span class="n">doc</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">svg</span><span class="p">;</span>

<span class="w">        </span><span class="n">plugin</span><span class="p">.</span><span class="n">apply</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">doc</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">doc</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">circle</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;data-custom&quot;</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="s">&quot;processed&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="step-2-register-the-plugin">Step 2: Register the Plugin<a class="headerlink" href="#step-2-register-the-plugin" title="Permanent link">&para;</a></h3>
<p>Add your plugin to <code>crates/plugin-sdk/src/plugins/mod.rs</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Add to the plugin modules</span>
<span class="k">pub</span><span class="w"> </span><span class="k">mod</span><span class="w"> </span><span class="nn">my_custom_plugin</span><span class="p">;</span>

<span class="c1">// In the create_default_registry function, add:</span>
<span class="n">registry</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="nb">Box</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">my_custom_plugin</span><span class="p">::</span><span class="n">MyCustomPlugin</span><span class="p">::</span><span class="n">new</span><span class="p">()));</span>
</code></pre></div>
<h3 id="step-3-build-and-test">Step 3: Build and Test<a class="headerlink" href="#step-3-build-and-test" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Run tests</span>
cargo<span class="w"> </span><span class="nb">test</span><span class="w"> </span>my_custom_plugin

<span class="c1"># Build the project</span>
cargo<span class="w"> </span>build<span class="w"> </span>--release

<span class="c1"># Test with CLI</span>
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;&lt;svg&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; width=&quot;100&quot; height=&quot;100&quot;/&gt;&lt;/svg&gt;&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>target/release/vexy-svgo<span class="w"> </span>--enable<span class="w"> </span>myCustomPlugin
</code></pre></div>
<h2 id="advanced-plugin-development">Advanced Plugin Development<a class="headerlink" href="#advanced-plugin-development" title="Permanent link">&para;</a></h2>
<h3 id="working-with-complex-ast-transformations">Working with Complex AST Transformations<a class="headerlink" href="#working-with-complex-ast-transformations" title="Permanent link">&para;</a></h3>
<p>Here's a more advanced plugin that optimizes gradients by removing duplicates:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// this_file: crates/plugin-sdk/src/plugins/optimize_gradients.rs</span>

<span class="k">use</span><span class="w"> </span><span class="k">crate</span><span class="p">::</span><span class="n">Plugin</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">anyhow</span><span class="p">::</span><span class="nb">Result</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">serde</span><span class="p">::{</span><span class="n">Deserialize</span><span class="p">,</span><span class="w"> </span><span class="n">Serialize</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">serde_json</span><span class="p">::</span><span class="n">Value</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">vexy_svgo_core</span><span class="p">::</span><span class="n">ast</span><span class="p">::{</span><span class="n">Document</span><span class="p">,</span><span class="w"> </span><span class="n">Element</span><span class="p">,</span><span class="w"> </span><span class="n">Node</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">collections</span><span class="p">::{</span><span class="n">HashMap</span><span class="p">,</span><span class="w"> </span><span class="n">HashSet</span><span class="p">};</span>

<span class="cp">#[derive(Debug, Clone, Serialize, Deserialize)]</span>
<span class="cp">#[serde(rename_all = </span><span class="s">&quot;camelCase&quot;</span><span class="cp">, deny_unknown_fields)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">OptimizeGradientsConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="sd">/// Remove unused gradients</span>
<span class="w">    </span><span class="cp">#[serde(default = </span><span class="s">&quot;default_true&quot;</span><span class="cp">)]</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">remove_unused</span><span class="p">:</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span>
<span class="w">    </span><span class="sd">/// Merge duplicate gradients</span>
<span class="w">    </span><span class="cp">#[serde(default = </span><span class="s">&quot;default_true&quot;</span><span class="cp">)]</span><span class="w">  </span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">merge_duplicates</span><span class="p">:</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">fn</span><span class="w"> </span><span class="nf">default_true</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="nb">Default</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">OptimizeGradientsConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">default</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">remove_unused</span><span class="p">:</span><span class="w"> </span><span class="nc">true</span><span class="p">,</span>
<span class="w">            </span><span class="n">merge_duplicates</span><span class="p">:</span><span class="w"> </span><span class="nc">true</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="cp">#[derive(Clone)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">OptimizeGradientsPlugin</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">config</span><span class="p">:</span><span class="w"> </span><span class="nc">OptimizeGradientsConfig</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">OptimizeGradientsPlugin</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">new</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">config</span><span class="p">:</span><span class="w"> </span><span class="nc">OptimizeGradientsConfig</span><span class="p">::</span><span class="n">default</span><span class="p">(),</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">collect_gradient_info</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">document</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">Document</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">gradient_definitions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HashMap</span><span class="p">::</span><span class="n">new</span><span class="p">();</span><span class="w"> </span><span class="c1">// id -&gt; serialized gradient</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">used_gradients</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HashSet</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Find all gradient definitions in &lt;defs&gt;</span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">find_gradients</span><span class="p">(</span><span class="o">&amp;</span><span class="n">document</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">gradient_definitions</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Find all gradient references </span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">find_gradient_references</span><span class="p">(</span><span class="o">&amp;</span><span class="n">document</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">used_gradients</span><span class="p">);</span>

<span class="w">        </span><span class="p">(</span><span class="n">gradient_definitions</span><span class="p">,</span><span class="w"> </span><span class="n">used_gradients</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">find_gradients</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">element</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">Element</span><span class="p">,</span><span class="w"> </span><span class="n">gradients</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">element</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;defs&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="n">element</span><span class="p">.</span><span class="n">children</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="fm">matches!</span><span class="p">(</span><span class="n">elem</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="n">as_ref</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;linearGradient&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;radialGradient&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">elem</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="c1">// Create a canonical representation of the gradient</span>
<span class="w">                            </span><span class="kd">let</span><span class="w"> </span><span class="n">canonical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">serialize_gradient</span><span class="p">(</span><span class="n">elem</span><span class="p">);</span>
<span class="w">                            </span><span class="n">gradients</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">id</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"> </span><span class="n">canonical</span><span class="p">);</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Recursively search child elements</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="n">element</span><span class="p">.</span><span class="n">children</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="bp">self</span><span class="p">.</span><span class="n">find_gradients</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span><span class="w"> </span><span class="n">gradients</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">find_gradient_references</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">element</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">Element</span><span class="p">,</span><span class="w"> </span><span class="n">used</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Check fill and stroke attributes for url() references</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">attr_value</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;fill&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;stroke&quot;</span><span class="p">].</span><span class="n">iter</span><span class="p">().</span><span class="n">filter_map</span><span class="p">(</span><span class="o">|</span><span class="n">attr</span><span class="o">|</span><span class="w"> </span><span class="n">element</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="o">*</span><span class="n">attr</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">attr_value</span><span class="p">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s">&quot;url(#&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">attr_value</span><span class="p">.</span><span class="n">ends_with</span><span class="p">(</span><span class="sc">&#39;)&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">attr_value</span><span class="p">[</span><span class="mi">5</span><span class="o">..</span><span class="n">attr_value</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
<span class="w">                </span><span class="n">used</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">id</span><span class="p">.</span><span class="n">to_string</span><span class="p">());</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Recursively search child elements</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="n">element</span><span class="p">.</span><span class="n">children</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="bp">self</span><span class="p">.</span><span class="n">find_gradient_references</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span><span class="w"> </span><span class="n">used</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">serialize_gradient</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">gradient</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">Element</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Create a canonical string representation for comparison</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">parts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="n">gradient</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="n">to_string</span><span class="p">()];</span>

<span class="w">        </span><span class="c1">// Add sorted attributes (excluding id)</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">attrs</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gradient</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="o">|</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">key</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;id&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">collect</span><span class="p">();</span>
<span class="w">        </span><span class="n">attrs</span><span class="p">.</span><span class="n">sort_by_key</span><span class="p">(</span><span class="o">|</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">key</span><span class="p">);</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">attrs</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">parts</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{}={}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Add stops</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="n">gradient</span><span class="p">.</span><span class="n">children</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">stop</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;stop&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">stop_attrs</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stop</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">collect</span><span class="p">();</span>
<span class="w">                    </span><span class="n">stop_attrs</span><span class="p">.</span><span class="n">sort_by_key</span><span class="p">(</span><span class="o">|</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">key</span><span class="p">);</span>
<span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="n">stop_str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stop_attrs</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{}={}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">))</span>
<span class="w">                        </span><span class="p">.</span><span class="n">collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">);</span>
<span class="w">                    </span><span class="n">parts</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;stop[{}]&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">stop_str</span><span class="p">));</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">parts</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;|&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">remove_unused_gradients</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">document</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Document</span><span class="p">,</span><span class="w"> </span><span class="n">used</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">HashSet</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">remove_unused_from_element</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">document</span><span class="p">.</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">used</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">remove_unused_from_element</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">element</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Element</span><span class="p">,</span><span class="w"> </span><span class="n">used</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">HashSet</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">element</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;defs&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">element</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">retain</span><span class="p">(</span><span class="o">|</span><span class="n">child</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="fm">matches!</span><span class="p">(</span><span class="n">elem</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="n">as_ref</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;linearGradient&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;radialGradient&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">elem</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="k">return</span><span class="w"> </span><span class="n">used</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="kc">true</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Recursively process child elements</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">element</span><span class="p">.</span><span class="n">children</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="bp">self</span><span class="p">.</span><span class="n">remove_unused_from_element</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span><span class="w"> </span><span class="n">used</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="nb">Default</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">OptimizeGradientsPlugin</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">default</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">Self</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">OptimizeGradientsPlugin</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="nb">static</span><span class="w"> </span><span class="kt">str</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;optimizeGradients&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="nb">static</span><span class="w"> </span><span class="kt">str</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;removes duplicate and unused gradients&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">validate_params</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">Value</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">params</span><span class="p">.</span><span class="n">is_null</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">serde_json</span><span class="p">::</span><span class="n">from_value</span><span class="p">::</span><span class="o">&lt;</span><span class="n">OptimizeGradientsConfig</span><span class="o">&gt;</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">clone</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="n">map_err</span><span class="p">(</span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"> </span><span class="n">anyhow</span><span class="p">::</span><span class="n">anyhow</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;Invalid plugin configuration: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">))</span><span class="o">?</span><span class="p">;</span>
<span class="w">            </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">document</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Document</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">gradients</span><span class="p">,</span><span class="w"> </span><span class="n">used</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">collect_gradient_info</span><span class="p">(</span><span class="n">document</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">remove_unused</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="bp">self</span><span class="p">.</span><span class="n">remove_unused_gradients</span><span class="p">(</span><span class="n">document</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">used</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">merge_duplicates</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// TODO: Implement duplicate merging logic</span>
<span class="w">            </span><span class="c1">// This would involve finding gradients with identical canonical forms</span>
<span class="w">            </span><span class="c1">// and updating references to use a single gradient definition</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="cp">#[cfg(test)]</span>
<span class="k">mod</span><span class="w"> </span><span class="nn">tests</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">borrow</span><span class="p">::</span><span class="n">Cow</span><span class="p">;</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">create_element</span><span class="p">(</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="nb">static</span><span class="w"> </span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Element</span><span class="o">&lt;&#39;</span><span class="nb">static</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Element</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="w">        </span><span class="n">element</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cow</span><span class="p">::</span><span class="n">Borrowed</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="w">        </span><span class="n">element</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cp">#[test]</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">test_removes_unused_gradients</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">plugin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OptimizeGradientsPlugin</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Document</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Create SVG with unused gradient</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">svg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_element</span><span class="p">(</span><span class="s">&quot;svg&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">defs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_element</span><span class="p">(</span><span class="s">&quot;defs&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">used_gradient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_element</span><span class="p">(</span><span class="s">&quot;linearGradient&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">used_gradient</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;used&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">());</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">unused_gradient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_element</span><span class="p">(</span><span class="s">&quot;linearGradient&quot;</span><span class="p">);</span><span class="w">  </span>
<span class="w">        </span><span class="n">unused_gradient</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;unused&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">());</span>

<span class="w">        </span><span class="n">defs</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">used_gradient</span><span class="p">));</span>
<span class="w">        </span><span class="n">defs</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">unused_gradient</span><span class="p">));</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">rect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_element</span><span class="p">(</span><span class="s">&quot;rect&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">rect</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;fill&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;url(#used)&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">());</span>

<span class="w">        </span><span class="n">svg</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">defs</span><span class="p">));</span>
<span class="w">        </span><span class="n">svg</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">rect</span><span class="p">));</span>
<span class="w">        </span><span class="n">doc</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">svg</span><span class="p">;</span>

<span class="w">        </span><span class="n">plugin</span><span class="p">.</span><span class="n">apply</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">doc</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Check that unused gradient was removed</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">defs_elem</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">doc</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">defs_elem</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">len</span><span class="p">(),</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">defs_elem</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">gradient</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="s">&quot;used&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="plugin-state-and-context">Plugin State and Context<a class="headerlink" href="#plugin-state-and-context" title="Permanent link">&para;</a></h3>
<p>Plugins can maintain internal state to coordinate complex optimizations:</p>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">StatefulPlugin</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">config</span><span class="p">:</span><span class="w"> </span><span class="nc">StatefulPluginConfig</span><span class="p">,</span>
<span class="w">    </span><span class="c1">// Maintain state between element visits</span>
<span class="w">    </span><span class="n">collected_ids</span><span class="p">:</span><span class="w"> </span><span class="nc">HashSet</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">id_references</span><span class="p">:</span><span class="w"> </span><span class="nc">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">StatefulPlugin</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">document</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Document</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// First pass: collect information</span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">collect_information</span><span class="p">(</span><span class="o">&amp;</span><span class="n">document</span><span class="p">.</span><span class="n">root</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Second pass: apply optimizations based on collected data</span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">apply_optimizations</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">document</span><span class="p">.</span><span class="n">root</span><span class="p">);</span>

<span class="w">        </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="testing-your-plugin">Testing Your Plugin<a class="headerlink" href="#testing-your-plugin" title="Permanent link">&para;</a></h2>
<h3 id="unit-testing">Unit Testing<a class="headerlink" href="#unit-testing" title="Permanent link">&para;</a></h3>
<p>Create comprehensive tests using the current testing framework:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#[cfg(test)]</span>
<span class="k">mod</span><span class="w"> </span><span class="nn">tests</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">serde_json</span><span class="p">::</span><span class="n">json</span><span class="p">;</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">borrow</span><span class="p">::</span><span class="n">Cow</span><span class="p">;</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">vexy_svgo_core</span><span class="p">::</span><span class="n">ast</span><span class="p">::{</span><span class="n">Document</span><span class="p">,</span><span class="w"> </span><span class="n">Element</span><span class="p">,</span><span class="w"> </span><span class="n">Node</span><span class="p">};</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">create_element</span><span class="p">(</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="nb">static</span><span class="w"> </span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Element</span><span class="o">&lt;&#39;</span><span class="nb">static</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Element</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="w">        </span><span class="n">element</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cow</span><span class="p">::</span><span class="n">Borrowed</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="w">        </span><span class="n">element</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cp">#[test]</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">test_plugin_basic_functionality</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">plugin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyCustomPlugin</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Document</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Create test SVG structure</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">svg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_element</span><span class="p">(</span><span class="s">&quot;svg&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">svg</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">create_element</span><span class="p">(</span><span class="s">&quot;rect&quot;</span><span class="p">)));</span>
<span class="w">        </span><span class="n">doc</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">svg</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Apply plugin</span>
<span class="w">        </span><span class="n">plugin</span><span class="p">.</span><span class="n">apply</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">doc</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Verify expected changes</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">doc</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">assert!</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">contains_key</span><span class="p">(</span><span class="s">&quot;data-processed&quot;</span><span class="p">));</span>
<span class="w">            </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;data-processed&quot;</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="s">&quot;true&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cp">#[test]</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">test_plugin_configuration</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyCustomPluginConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">attr_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;data-test&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span>
<span class="w">            </span><span class="n">attr_value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span>
<span class="w">            </span><span class="n">target_elements</span><span class="p">:</span><span class="w"> </span><span class="nc">vec</span><span class="o">!</span><span class="p">[</span><span class="s">&quot;circle&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()],</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">plugin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyCustomPlugin</span><span class="p">::</span><span class="n">with_config</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Test with custom configuration</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Document</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">svg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_element</span><span class="p">(</span><span class="s">&quot;svg&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">svg</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">create_element</span><span class="p">(</span><span class="s">&quot;circle&quot;</span><span class="p">)));</span>
<span class="w">        </span><span class="n">doc</span><span class="p">.</span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">svg</span><span class="p">;</span>

<span class="w">        </span><span class="n">plugin</span><span class="p">.</span><span class="n">apply</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">doc</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Node</span><span class="p">::</span><span class="n">Element</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">doc</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">circle</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;data-test&quot;</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="s">&quot;yes&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cp">#[test]</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">test_parameter_validation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">plugin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyCustomPlugin</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Valid parameters</span>
<span class="w">        </span><span class="fm">assert!</span><span class="p">(</span><span class="n">plugin</span><span class="p">.</span><span class="n">validate_params</span><span class="p">(</span><span class="o">&amp;</span><span class="n">json</span><span class="o">!</span><span class="p">(</span><span class="n">null</span><span class="p">)).</span><span class="n">is_ok</span><span class="p">());</span>
<span class="w">        </span><span class="fm">assert!</span><span class="p">(</span><span class="n">plugin</span><span class="p">.</span><span class="n">validate_params</span><span class="p">(</span><span class="o">&amp;</span><span class="n">json</span><span class="o">!</span><span class="p">({})).</span><span class="n">is_ok</span><span class="p">());</span>
<span class="w">        </span><span class="fm">assert!</span><span class="p">(</span><span class="n">plugin</span><span class="p">.</span><span class="n">validate_params</span><span class="p">(</span><span class="o">&amp;</span><span class="n">json</span><span class="o">!</span><span class="p">({</span>
<span class="w">            </span><span class="s">&quot;attrName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;custom&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;attrValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;targetElements&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;rect&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;circle&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="p">})).</span><span class="n">is_ok</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// Invalid parameters</span>
<span class="w">        </span><span class="fm">assert!</span><span class="p">(</span><span class="n">plugin</span><span class="p">.</span><span class="n">validate_params</span><span class="p">(</span><span class="o">&amp;</span><span class="n">json</span><span class="o">!</span><span class="p">({</span>
<span class="w">            </span><span class="s">&quot;invalidField&quot;</span><span class="p">:</span><span class="w"> </span><span class="nc">true</span>
<span class="w">        </span><span class="p">})).</span><span class="n">is_err</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Use the plugin fixture testing framework for SVGO compatibility</span>
<span class="c1">// This macro automatically generates tests based on SVGO test fixtures</span>
<span class="k">crate</span><span class="p">::</span><span class="n">plugin_fixture_tests</span><span class="o">!</span><span class="p">(</span><span class="n">MyCustomPlugin</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;myCustomPlugin&quot;</span><span class="p">);</span>
</code></pre></div>
<h3 id="svgo-compatibility-testing">SVGO Compatibility Testing<a class="headerlink" href="#svgo-compatibility-testing" title="Permanent link">&para;</a></h3>
<p>The <code>plugin_fixture_tests!</code> macro automatically generates compatibility tests based on the original SVGO test fixtures. These tests ensure your plugin behaves identically to the SVGO equivalent:</p>
<ul>
<li><strong>Automatic Test Generation</strong>: Tests are created from <code>testdata/plugins/pluginName/*.txt</code> files</li>
<li><strong>Input/Output Validation</strong>: Each test compares your plugin's output with SVGO's expected output</li>
<li><strong>Parameter Testing</strong>: Tests various plugin configurations and edge cases</li>
<li><strong>Regression Prevention</strong>: Catches any behavioral differences from SVGO</li>
</ul>
<p>To add fixture tests for your plugin:</p>
<ol>
<li>Add your plugin test cases to <code>testdata/plugins/myCustomPlugin/</code></li>
<li>Use the format: <code>01.txt</code>, <code>02.txt</code>, etc.</li>
<li>Each file contains input SVG, expected output, and optional configuration</li>
<li>Add the macro call: <code>crate::plugin_fixture_tests!(MyCustomPlugin, "myCustomPlugin");</code></li>
</ol>
<p>Example fixture file (<code>testdata/plugins/myCustomPlugin/01.txt</code>):
<div class="highlight"><pre><span></span><code>===
Add custom attribute to rect elements
===

&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;
  &lt;rect width=&quot;100&quot; height=&quot;100&quot;/&gt;
  &lt;circle r=&quot;50&quot;/&gt;
&lt;/svg&gt;

@@@

&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;
  &lt;rect width=&quot;100&quot; height=&quot;100&quot; data-processed=&quot;true&quot;/&gt;
  &lt;circle r=&quot;50&quot;/&gt;
&lt;/svg&gt;
</code></pre></div></p>
<h3 id="integration-testing">Integration Testing<a class="headerlink" href="#integration-testing" title="Permanent link">&para;</a></h3>
<p>Test your plugin with the full Vexy SVGO pipeline:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#[cfg(test)]</span>
<span class="k">mod</span><span class="w"> </span><span class="nn">integration_tests</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">vexy_svgo_core</span><span class="p">::{</span><span class="n">optimize_with_config</span><span class="p">,</span><span class="w"> </span><span class="n">Config</span><span class="p">,</span><span class="w"> </span><span class="n">PluginConfig</span><span class="p">};</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">serde_json</span><span class="p">::</span><span class="n">json</span><span class="p">;</span>

<span class="w">    </span><span class="cp">#[test]</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">test_plugin_in_pipeline</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">plugins</span><span class="p">:</span><span class="w"> </span><span class="nc">vec</span><span class="o">!</span><span class="p">[</span>
<span class="w">                </span><span class="n">PluginConfig</span><span class="p">::</span><span class="n">Name</span><span class="p">(</span><span class="s">&quot;removeComments&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()),</span>
<span class="w">                </span><span class="n">PluginConfig</span><span class="p">::</span><span class="n">Name</span><span class="p">(</span><span class="s">&quot;myCustomPlugin&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()),</span>
<span class="w">                </span><span class="n">PluginConfig</span><span class="p">::</span><span class="n">WithParams</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;optimizeGradients&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span>
<span class="w">                    </span><span class="n">params</span><span class="p">:</span><span class="w"> </span><span class="nc">json</span><span class="o">!</span><span class="p">({</span><span class="s">&quot;removeUnused&quot;</span><span class="p">:</span><span class="w"> </span><span class="nc">true</span><span class="p">}),</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="n">multipass</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span><span class="p">,</span>
<span class="w">            </span><span class="o">..</span><span class="nb">Default</span><span class="p">::</span><span class="n">default</span><span class="p">()</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">svg_input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">r#&quot;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;</span>
<span class="s">            &lt;!-- Comment to remove --&gt;</span>
<span class="s">            &lt;defs&gt;</span>
<span class="s">                &lt;linearGradient id=&quot;unused&quot;/&gt;</span>
<span class="s">                &lt;linearGradient id=&quot;used&quot;/&gt;</span>
<span class="s">            &lt;/defs&gt;</span>
<span class="s">            &lt;rect fill=&quot;url(#used)&quot;/&gt;</span>
<span class="s">        &lt;/svg&gt;&quot;#</span><span class="p">;</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">optimize_with_config</span><span class="p">(</span><span class="n">svg_input</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Verify all plugins ran correctly</span>
<span class="w">        </span><span class="fm">assert!</span><span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&quot;&lt;!-- Comment to remove --&gt;&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="fm">assert!</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&quot;data-processed&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="fm">assert!</span><span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&quot;id=</span><span class="se">\&quot;</span><span class="s">unused</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="fm">assert!</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&quot;id=</span><span class="se">\&quot;</span><span class="s">used</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="performance-testing">Performance Testing<a class="headerlink" href="#performance-testing" title="Permanent link">&para;</a></h3>
<p>Add benchmarks using the Criterion framework:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#[cfg(test)]</span>
<span class="k">mod</span><span class="w"> </span><span class="nn">benches</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">criterion</span><span class="p">::{</span><span class="n">black_box</span><span class="p">,</span><span class="w"> </span><span class="n">Criterion</span><span class="p">};</span>

<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">benchmark_plugin</span><span class="p">(</span><span class="n">c</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Criterion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">svg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generate_large_test_svg</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"> </span><span class="c1">// Create test SVG with 1000 elements</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">plugin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyCustomPlugin</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>

<span class="w">        </span><span class="n">c</span><span class="p">.</span><span class="n">bench_function</span><span class="p">(</span><span class="s">&quot;my_custom_plugin&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">b</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">b</span><span class="p">.</span><span class="n">iter</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vexy_svgo_core</span><span class="p">::</span><span class="n">parse_svg</span><span class="p">(</span><span class="n">black_box</span><span class="p">(</span><span class="o">&amp;</span><span class="n">svg</span><span class="p">)).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">                </span><span class="n">plugin</span><span class="p">.</span><span class="n">apply</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">doc</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">generate_large_test_svg</span><span class="p">(</span><span class="n">element_count</span><span class="p">:</span><span class="w"> </span><span class="kt">usize</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">svg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">r#&quot;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;&quot;#</span><span class="p">);</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="n">element_count</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">svg</span><span class="p">.</span><span class="n">push_str</span><span class="p">(</span><span class="o">&amp;</span><span class="fm">format!</span><span class="p">(</span>
<span class="w">                </span><span class="s">r#&quot;&lt;rect x=&quot;{}&quot; y=&quot;{}&quot; width=&quot;10&quot; height=&quot;10&quot;/&gt;&quot;#</span><span class="p">,</span>
<span class="w">                </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span>
<span class="w">            </span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">svg</span><span class="p">.</span><span class="n">push_str</span><span class="p">(</span><span class="s">&quot;&lt;/svg&gt;&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">svg</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="publishing-and-distribution">Publishing and Distribution<a class="headerlink" href="#publishing-and-distribution" title="Permanent link">&para;</a></h2>
<h3 id="1-package-your-plugin">1. Package Your Plugin<a class="headerlink" href="#1-package-your-plugin" title="Permanent link">&para;</a></h3>
<p>Create a separate crate for distribution:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Cargo.toml</span>
<span class="k">[package]</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;vexy-svgo-plugin-custom&quot;</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0.1.0&quot;</span>
<span class="n">edition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2021&quot;</span>

<span class="k">[dependencies]</span>
<span class="n">vexy-svgo-plugin-sdk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span>
<span class="n">vexy-svgo-core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span>
<span class="n">anyhow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span>
<span class="n">serde</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">features</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;derive&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="n">serde_json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span>

<span class="k">[dev-dependencies]</span>
<span class="n">vexy-svgo-test-utils</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span>
</code></pre></div>
<h3 id="2-documentation">2. Documentation<a class="headerlink" href="#2-documentation" title="Permanent link">&para;</a></h3>
<p>Document your plugin thoroughly:</p>
<div class="highlight"><pre><span></span><code><span class="sd">//! # Custom Vexy SVGO Plugin</span>
<span class="sd">//!</span>
<span class="sd">//! This plugin adds custom attributes to SVG elements based on configurable rules.</span>
<span class="sd">//!</span>
<span class="sd">//! ## Usage</span>
<span class="sd">//!</span>
<span class="sd">//! ```rust</span>
<span class="sd">//! use vexy-svgo-plugin-custom::MyCustomPlugin;</span>
<span class="sd">//! use vexy-svgo-core::Config;</span>
<span class="sd">//!</span>
<span class="sd">//! let mut config = Config::default();</span>
<span class="sd">//! config.plugins.push(PluginConfig::Name(&quot;myCustomPlugin&quot;.to_string()));</span>
<span class="sd">//! ```</span>
<span class="sd">//!</span>
<span class="sd">//! ## Configuration</span>
<span class="sd">//!</span>
<span class="sd">//! The plugin accepts the following parameters:</span>
<span class="sd">//!</span>
<span class="sd">//! - `attribute_name`: The name of the attribute to add (default: &quot;data-custom&quot;)</span>
<span class="sd">//! - `attribute_value`: The value of the attribute (default: &quot;processed&quot;)</span>
<span class="sd">//! - `target_class`: Optional class name to filter elements</span>
</code></pre></div>
<h3 id="3-publish-to-cratesio">3. Publish to crates.io<a class="headerlink" href="#3-publish-to-cratesio" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Ensure tests pass</span>
cargo<span class="w"> </span><span class="nb">test</span>

<span class="c1"># Check documentation</span>
cargo<span class="w"> </span>doc<span class="w"> </span>--open

<span class="c1"># Publish</span>
cargo<span class="w"> </span>publish
</code></pre></div>
<h2 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h2>
<h3 id="1-performance-optimization">1. Performance Optimization<a class="headerlink" href="#1-performance-optimization" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Minimize Allocations</strong>: Reuse strings and collections where possible</li>
<li><strong>Early Returns</strong>: Skip processing when conditions aren't met</li>
<li><strong>Batch Operations</strong>: Group similar modifications together</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Visitor</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">EfficientPlugin</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">visit_element_enter</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">element</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Element</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="2-error-handling">2. Error Handling<a class="headerlink" href="#2-error-handling" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Graceful Degradation</strong>: Don't break the entire optimization on minor errors</li>
<li><strong>Informative Messages</strong>: Provide context in error messages</li>
<li><strong>Recovery Strategies</strong>: Implement fallbacks for common issues</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">fn</span><span class="w"> </span><span class="nf">process_element</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">element</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Element</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="3-configuration-validation">3. Configuration Validation<a class="headerlink" href="#3-configuration-validation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ValidatedPlugin</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">:</span><span class="w"> </span><span class="nc">serde_json</span><span class="p">::</span><span class="n">Value</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="4-compatibility">4. Compatibility<a class="headerlink" href="#4-compatibility" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>SVGO Parity</strong>: Match SVGO behavior when implementing equivalent plugins</li>
<li><strong>Backward Compatibility</strong>: Don't break existing configurations</li>
<li><strong>Feature Detection</strong>: Check for optional dependencies</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">CompatiblePlugin</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">optimize</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">document</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Document</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="plugin-ideas">Plugin Ideas<a class="headerlink" href="#plugin-ideas" title="Permanent link">&para;</a></h2>
<p>Here are some plugin ideas to inspire your development:</p>
<ol>
<li><strong>Accessibility Enhancer</strong>: Add ARIA labels and roles automatically</li>
<li><strong>Animation Optimizer</strong>: Optimize SMIL animations and CSS animations</li>
<li><strong>Icon Sprite Generator</strong>: Combine multiple icons into a sprite sheet</li>
<li><strong>Responsive SVG</strong>: Add viewBox and preserveAspectRatio for responsive designs</li>
<li><strong>Security Scanner</strong>: Detect and remove potentially malicious content</li>
<li><strong>Style Optimizer</strong>: Convert inline styles to CSS classes</li>
<li><strong>Path Simplifier</strong>: Advanced path optimization beyond convertPathData</li>
<li><strong>Metadata Manager</strong>: Add/update copyright, license, and attribution</li>
<li><strong>Theme Converter</strong>: Convert colors to CSS variables for theming</li>
<li><strong>Performance Profiler</strong>: Add timing marks for animation performance</li>
</ol>
<h2 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://docs.rs/vexy-svgo-plugin-sdk">Vexy SVGO Plugin SDK Documentation</a></li>
<li><a href="https://www.w3.org/TR/SVG2/">SVG Specification</a></li>
<li><a href="https://github.com/svg/svgo#plugins">SVGO Plugin Reference</a></li>
<li><a href="https://rust-unofficial.github.io/patterns/patterns/behavioural/visitor.html">Rust Visitor Pattern Guide</a></li>
</ul>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>Creating Vexy SVGO plugins allows you to extend the optimizer with custom functionality while maintaining the performance benefits of Rust. Start with simple transformations and gradually build more complex optimizations as you become familiar with the AST and visitor pattern.</p>
<p>Remember to:
- Test thoroughly with various SVG inputs
- Document your plugin's behavior and configuration
- Consider performance implications
- Share your plugins with the community</p>
<p>Happy plugin development! 🚀</p>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/vexyart/vexy-svgo" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.sections", "navigation.top", "content.code.copy", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
        <script src="../../assets/js/svgo-optimizer.js"></script>
      
        <script src="../../assets/js/theme.js"></script>
      
    
  </body>
</html>